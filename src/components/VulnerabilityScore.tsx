'use client';

import { useEffect, useState } from 'react';
import { ShieldAlert, ShieldCheck, Shield } from 'lucide-react';

interface VulnerabilityScoreProps {
    score: number;
}

export default function VulnerabilityScore({ score }: VulnerabilityScoreProps) {
    const [displayScore, setDisplayScore] = useState(0);
    const [animationComplete, setAnimationComplete] = useState(false);

    useEffect(() => {
        setDisplayScore(0);
        setAnimationComplete(false);

        const duration = 2000;
        const steps = 60;
        const increment = score / steps;
        let current = 0;

        const timer = setInterval(() => {
            current += increment;
            if (current >= score) {
                setDisplayScore(score);
                setAnimationComplete(true);
                clearInterval(timer);
            } else {
                setDisplayScore(Math.floor(current));
            }
        }, duration / steps);

        return () => clearInterval(timer);
    }, [score]);

    const getScoreColor = (s: number) => {
        if (s >= 70) return { primary: '#ff3366', secondary: '#ff6699', label: 'CRITICAL', bg: 'rgba(255, 51, 102, 0.1)' };
        if (s >= 40) return { primary: '#ffcc00', secondary: '#ffdd44', label: 'MODERATE', bg: 'rgba(255, 204, 0, 0.1)' };
        return { primary: '#00ff88', secondary: '#44ffaa', label: 'LOW', bg: 'rgba(0, 255, 136, 0.1)' };
    };

    const colors = getScoreColor(displayScore);
    const circumference = 2 * Math.PI * 45;
    const strokeDashoffset = circumference - (displayScore / 100) * circumference;

    const ScoreIcon = score >= 70 ? ShieldAlert : score >= 40 ? Shield : ShieldCheck;

    return (
        <div className="cyber-glass p-8">
            <div className="flex items-center gap-3 mb-4">
                <ScoreIcon className="w-5 h-5" style={{ color: colors.primary }} />
                <h2 className="text-lg font-semibold text-white">Vulnerability Score</h2>
            </div>

            <div className="flex items-center justify-center py-4">
                <div className="relative w-36 h-36">
                    {/* Background circle */}
                    <svg className="w-full h-full transform -rotate-90">
                        <circle
                            cx="72"
                            cy="72"
                            r="45"
                            stroke="rgba(255, 255, 255, 0.1)"
                            strokeWidth="8"
                            fill="none"
                        />
                        {/* Animated score circle */}
                        <circle
                            cx="72"
                            cy="72"
                            r="45"
                            stroke={colors.primary}
                            strokeWidth="8"
                            fill="none"
                            strokeLinecap="round"
                            strokeDasharray={circumference}
                            strokeDashoffset={strokeDashoffset}
                            style={{
                                transition: 'stroke-dashoffset 0.1s ease-out',
                                filter: `drop-shadow(0 0 10px ${colors.primary})`,
                            }}
                        />
                    </svg>

                    {/* Score text */}
                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                        <span
                            className="text-4xl font-bold"
                            style={{ color: colors.primary }}
                        >
                            {displayScore}
                        </span>
                        <span className="text-xs text-gray-600 uppercase tracking-wider">/ 100</span>
                    </div>
                </div>
            </div>

            {/* Risk label */}
            <div
                className="text-center py-2 rounded-lg font-semibold text-sm"
                style={{
                    backgroundColor: colors.bg,
                    color: colors.primary,
                }}
            >
                {colors.label} RISK
            </div>

            {/* Score breakdown hint */}
            {animationComplete && (
                <div className="mt-4 space-y-2 text-xs text-gray-400">
                    <div className="flex justify-between">
                        <span>Data Breach Exposure</span>
                        <span className="text-pink-500">+35</span>
                    </div>
                    <div className="flex justify-between">
                        <span>Social Media Visibility</span>
                        <span className="text-amber-400">+25</span>
                    </div>
                    <div className="flex justify-between">
                        <span>Contact Info Leakage</span>
                        <span className="text-amber-400">+15</span>
                    </div>
                    <div className="flex justify-between">
                        <span>Location Data</span>
                        <span className="text-green-400">+10</span>
                    </div>
                </div>
            )}
        </div>
    );
}
